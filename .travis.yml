language: node_js
node_js:
 - "4.2"
services:
 - mongodb
addons:
 hosts:
  - qili.server
  - qili.db
 apt:
  packages:
   - sshpass
before_script:
 - mkdir test
 - mkdir test/data
 - mkdir test/data/apps
 - sleep 5
 - npm start &
 - sleep 2

after_success:
 - node scripts/replaceEnv.js .travis.deploy.sh qili.travis.deploy.sh
 - sshpass -p $DEPLOY_PASSWORD scp qili.travis.deploy.sh $DEPLOY_USER@$DEPLOY_HOST:qili.travis.deploy.sh
 - sshpass -p $DEPLOY_PASSWORD ssh $DEPLOY_USER@$DEPLOY_HOST ./qili.travis.deploy.sh
 - echo done
